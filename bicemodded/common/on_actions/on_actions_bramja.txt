
#!!TO DO!!
# on_puppet = 
#3.1# Add effects to X Forces & certain industries from pupetted majors ( Treaty restrictions a la Versaille)
#-3.2# add option to allow remilitarize by master + allow decision subject to negotiate away
#has_claimed_state_in_peace_conference
#--> Poland West/ [loose cores GER?] / Hungary?


#stabilize puppet & civil war.
on_actions = {
	on_puppet = {
		effect = {
			if = {
				limit = {
					date > 1945.1.1
				}
				add_ideas = disarmed_nation
			}
			else_if = {
				limit = {
					OR = {
						has_idea = service_by_requirement
						has_idea = all_adults_serve
						has_idea = scraping_the_barrel
					}
				}
				add_ideas = extensive_conscription
			}
			if = {
				limit = {
					date > 1945.1.1
				}
				add_ideas = low_economic_mobilisation
			}
			else_if = {
				limit = {
					OR = {
						has_idea = war_economy
						has_idea = tot_economic_mobilisation
					}
				}
				add_ideas = partial_economic_mobilisation
			}
			if = {
				limit = {
					date > 1941.1.1
					has_stability < 0.6
				}
				set_stability = 0.55
			}
			if = {
				limit = {
					date > 1941.1.1
					has_stability > 0.8
				}
				set_stability = 0.7
			}
			if = {
				limit = {
					date > 1941.1.1
					has_war_support < 0.6
				}
				set_war_support = 0.55
			}
			if = {
				limit = {
					date > 1941.1.1
					has_war_support > 0.75
				}
				set_war_support = 0.65
			}
			if = {
				limit = {
					has_country_flag = crisis_solution_in_progress
				}
				clr_country_flag = crisis_solution_in_progress
			}
			if = {
				limit = {
					has_country_flag = crisis_in_progress
				}
				clr_country_flag = crisis_in_progress
			}
			if = {
				limit = {
					OR = {
						has_idea = draft_dodging
						has_idea = draft_dodging_2
						has_idea = draft_dodging_3
					}
				}
				remove_ideas =  { 
					draft_dodging 
					draft_dodging_2
					draft_dodging_3
				}
			}
			if = {
				limit = {
					OR = {
						has_idea = strikes_1 
						has_idea = strikes_2
						has_idea = strikes_3
					}
				}
				remove_ideas =  {
					strikes_1 
					strikes_2
					strikes_3
				}
			}
			if = {
				limit = {
					OR = {
						has_idea = mutiny_1
						has_idea = mutiny_2
						has_idea = mutiny_3
					}
				}
				remove_ideas =  { 
					mutiny_1 
					mutiny_2
					mutiny_3
				}
			}
		}
	}

	on_liberate = {
		effect = {
			if = {
				limit = {
					OR = {
						has_idea = service_by_requirement
						has_idea = all_adults_serve
						has_idea = scraping_the_barrel
					}
				}
				add_ideas = extensive_conscription
			}
			if = {
				limit = {
					OR = {
						has_idea = war_economy
						has_idea = tot_economic_mobilisation
					}
				}
				add_ideas = partial_economic_mobilisation
			}
			if = {
				limit = {
					date > 1941.1.1
					has_stability < 0.6
				}
				set_stability = 0.55
			}
			if = {
				limit = {
					date > 1941.1.1
					has_war_support < 0.6
				}
				set_war_support = 0.55
			}
			if = {
				limit = {
					has_country_flag = crisis_solution_in_progress
				}
				clr_country_flag = crisis_solution_in_progress
			}
			if = {
				limit = {
					has_country_flag = crisis_in_progress
				}
				clr_country_flag = crisis_in_progress
			}
			if = {
				limit = {
					OR = {
						has_idea = draft_dodging
						has_idea = draft_dodging_2
						has_idea = draft_dodging_3
					}
				}
				remove_ideas =  { 
					draft_dodging 
					draft_dodging_2
					draft_dodging_3
				}
			}
			if = {
				limit = {
					OR = {
						has_idea = strikes_1 
						has_idea = strikes_2
						has_idea = strikes_3
					}
				}
				remove_ideas =  { 
					strikes_1 
					strikes_2
					strikes_3
				}
			}
			if = {
				limit = {
					OR = {
						has_idea = mutiny_1
						has_idea = mutiny_2
						has_idea = mutiny_3
					}
				}
				remove_ideas =  { 
					mutiny_1 
					mutiny_2
					mutiny_3
				}
			}
		}
	}

	on_release_as_free = {
		effect = {
			if = {
				limit = {
					OR = {
						has_idea = service_by_requirement
						has_idea = all_adults_serve
						has_idea = scraping_the_barrel
					}
				}
				add_ideas = extensive_conscription
			}
			if = {
				limit = {
					OR = {
						has_idea = war_economy
						has_idea = tot_economic_mobilisation
					}
				}
				add_ideas = partial_economic_mobilisation
			}
			if = {
				limit = {
					date > 1941.1.1
					has_stability < 0.6
				}
				set_stability = 0.55
			}
			if = {
				limit = {
					date > 1941.1.1
					has_war_support < 0.6
				}
				set_war_support = 0.55
			}
			if = {
				limit = {
					has_country_flag = crisis_solution_in_progress
				}
				clr_country_flag = crisis_solution_in_progress
			}
			if = {
				limit = {
					has_country_flag = crisis_in_progress
				}
				clr_country_flag = crisis_in_progress
			}
			if = {
				limit = {
					OR = {
						has_idea = draft_dodging
						has_idea = draft_dodging_2
						has_idea = draft_dodging_3
					}
				}
				remove_ideas =  { 
					draft_dodging 
					draft_dodging_2
					draft_dodging_3
				}
			}
			if = {
				limit = {
					OR = {
						has_idea = strikes_1 
						has_idea = strikes_2
						has_idea = strikes_3
					}
				}
				remove_ideas =  { 
					strikes_1 
					strikes_2
					strikes_3
				}
			}
			if = {
				limit = {
					OR = {
						has_idea = mutiny_1
						has_idea = mutiny_2
						has_idea = mutiny_3
					}
				}
				remove_ideas =  { 
					mutiny_1 
					mutiny_2
					mutiny_3
				}
			}
		}
	}

	on_release_as_puppet = {
		effect = {
			if = {
				limit = {
					OR = {
						has_idea = service_by_requirement
						has_idea = all_adults_serve
						has_idea = scraping_the_barrel
					}
				}
				add_ideas = extensive_conscription
			}
			if = {
				limit = {
					OR = {
						has_idea = war_economy
						has_idea = tot_economic_mobilisation
					}
				}
				add_ideas = partial_economic_mobilisation
			}
			if = {
				limit = {
					date > 1941.1.1
					has_stability < 0.6
				}
				set_stability = 0.55
			}
			if = {
				limit = {
					date > 1941.1.1
					has_stability > 0.8
				}
				set_stability = 0.7
			}
			if = {
				limit = {
					date > 1941.1.1
					has_war_support < 0.6
				}
				set_war_support = 0.55
			}
			if = {
				limit = {
					date > 1941.1.1
					has_war_support > 0.75
				}
				set_war_support = 0.65
			}
			if = {
				limit = {
					has_country_flag = crisis_solution_in_progress
				}
				clr_country_flag = crisis_solution_in_progress
			}
			if = {
				limit = {
					has_country_flag = crisis_in_progress
				}
				clr_country_flag = crisis_in_progress
			}
			if = {
				limit = {
					OR = {
						has_idea = draft_dodging
						has_idea = draft_dodging_2
						has_idea = draft_dodging_3
					}
				}
				remove_ideas = {
					draft_dodging 
					draft_dodging_2
					draft_dodging_3
				}
			}
			if = {
				limit = {
					OR = {
						has_idea = strikes_1 
						has_idea = strikes_2
						has_idea = strikes_3
					}
				}
				remove_ideas = { 
					strikes_1 
					strikes_2
					strikes_3
				}
			}
			if = {
				limit = {
					OR = {
						has_idea = mutiny_1
						has_idea = mutiny_2
						has_idea = mutiny_3
					}
				}
				remove_ideas = { 
					mutiny_1 
					mutiny_2
					mutiny_3
				}
			}
		}
	}

#to be tested!
	on_war = {
		effect = {
			if = {
				limit = {
					date > 1941.1.1
					has_civil_war = yes	
				}
				country_event = { id = bramja.19 }
				#set_rule = {
					#can_join_factions =  no
				#}
			}
		}
	}		

	#!!!Triggers ideas & Events for SOV control Eastern Europe
#	-->1st 2nd snd (on puppet & release as puppet)
	
	
	#used when puppeting in a peace conference
	#ROOT = nation being puppeted, FROM = overlord
	
	on_puppet = {
		effect = {
			if = {
				limit = {
					ROOT = {
						capital_scope = {
							is_on_continent = europe
						}
					}
					FROM = {
						original_tag = SOV
						has_government = communism
						has_country_leader = { name = "Joseph Stalin" }
					}
				}
				ROOT = {
					add_stability = -0.22
					add_war_support = -0.25
				}
				ROOT = { #represents communism not so strong/easily pushed by SOV in Europe, will be fixed in later event 
					add_popularity = {
						ideology = communism
						popularity = -0.27
					}
				}
				#ROOT = { add_ideas = partial_economic_mobilisation }
				#ROOT = { add_ideas = limited_conscription }
				ROOT = { add_timed_idea = {
					idea = officers_purged_EE 
						days = 240
					}
				}
				#FROM = { country_event = { id = bramja.xx days = 30 } } Here choice Stalinism/control
			}
			if = {
				limit = {
					OR = {
						tag = DDR
						tag = WGR
						original_tag = GER
					}
                    FROM = {
			    		original_tag = SOV
					}
				}
				ROOT = { add_timed_idea = {
					idea = denazification
						days = 720
					}
				}	
			}
			
			if = {
				limit = {
					ROOT = {
						OR = {
							tag = GER
							tag = DDR
							tag = WGR
							tag = JAP
							tag = ITA
							tag = ENG
							tag = USA
							tag = FRA
							tag = SOV
						}
					}
				}
				add_ideas = disarmed_nation
				add_ideas = low_economic_mobilisation
				add_named_threat = { threat = -25 name = Major_down_threat }
				if = {
					limit = {
					   has_dlc = "Man the Guns"
					}
					destroy_ships = {
					type = ship_hull_light
					count = all
					} 
					destroy_ships = {
					type = ship_hull_cruiser
					count = all
					}
					destroy_ships = {
					type = ship_hull_heavy_cruiser
					count = all
					}
					destroy_ships = {
					type = ship_hull_heavy
					count = all
					}
					destroy_ships = {
					type = ship_hull_carrier
					count = all
					}
					destroy_ships = {
					 type = ship_hull_submarine
					 count = all
					}
					# else = {
						# destroy_ships = {
						# type = destroyer
						# count = all
						# }  
						# destroy_ships = {
						# type = light_cruiser
						# count = all
						# }
						# destroy_ships = {
						# type = heavy_cruiser
						# count = all
						# }
						# destroy_ships = {
						# type = battleship
						# count = all
						# }
						# destroy_ships = {
						# type = carrier
						# count = all
						# }
						# destroy_ships = {
						# type = submarine
						# count = all
						# }
					# }
				}
			}
		}
					}
				}
			}
			}
		}
	}

	#!!TO DO!!
	
	# on_puppet = {
	#1.1# Add effects to X Forces & certain industries from pupetted majors ( Treaty restrictionds a la Versaille)
	#-1.2# add option to allow remilitarize by master + allow decision subject to negotiate away
	#has_claimed_state_in_peace_conference
	#--> Poland West/ loose cores GER? / Hungary?
			

	#Triggers ideas & Events for SOV control Eastern Europe
	
	#used when puppeting through the occupied territories menu during peace time (or when releasing from non-core but owned territory, f.e. Britain releasing Egypt)
	#ROOT = nation being released, FROM = overlord
	
	on_release_as_puppet = {
		effect = {
			if = {
				limit = {
					ROOT = {
						capital_scope = {
							is_on_continent = europe
						}
					}
					FROM = {
						original_tag = SOV
						has_government = communism
						has_country_leader = { name = "Joseph Stalin" }
					}
				}
				ROOT = { 
					add_stability = -0.2
					add_war_support = -0.25
				}
				ROOT = { 
					add_popularity = {
						ideology = communism
						popularity = -0.25
					}
				}
				#ROOT = { add_ideas = partial_economic_mobilisation }
				#ROOT = { add_ideas = limited_conscription }
				ROOT = { add_timed_idea = {
					idea = officers_purged_EE 
						days = 365
					}
				}
				#FROM = { country_event = { id = bramja.xx days = 30 } } Here choice Stalinism/controll
			}
			if = {
				limit = {
					OR = {
						tag = DDR
						tag = WGR
						original_tag = GER
					}
                    FROM = {
			    		original_tag = SOV
					}
				}
				ROOT = { add_timed_idea = {
					idea = denazification
						days = 720
					}
				}
			}
		}
	}


# Reduce war support after peace + 
# Test fire event war recov

	#ROOT is winner #FROM is loser
	on_peaceconference_ended = {
		effect = {
			ROOT = {
				if = {
					limit = {
						date > 1944.1.1
						has_war = no
						has_war_support > 0.75
					}
					add_war_support = -0.10 
				}
				else_if = {
					limit = {
						date > 1944.1.1
						has_war = yes
						has_war_support > 0.85
					}
					add_war_support = -0.05 
				}
			}
			if = {
				limit = {
					tag = SOV
					SOV = { has_completed_focus = SOV_industrial_war_mobilisation }
					GER = { OR = { has_capitulated = yes exists = no is_puppet = yes } }
				}
				SOV = { country_event = { id = bramja.33 days = 30 } }
			}
		}
	}
	
	
	#Trigger for Vojvodina event HUN
	
	#FROM is war target
	on_declare_war = {
		effect = {
			if = {
				limit = {
					FROM = { tag = YUG } 
					45 = { is_owned_by = YUG }
					NOT = { is_in_faction_with = HUN }
					OR = {
						has_government = fascism
						has_government = neutrality
					}
				}
				HUN = { country_event = { id = bramja.29 days = 3 } }
			}
		}
	}
	
	###Increases French stability if change gove & not puppet(away from democrat). Up survivability/viability alternative ideologies/gov
	
	on_government_change = {
		effect = {
			if = {
				limit = {
					original_tag = FRA
					NOT = { has_government = democratic }
					is_subject = no
					date < 1940.1.1
				}
				add_stability = 0.15
				add_war_support = 0.15
			}
		}
	}
	
	### Add compliance for states GER conquers in early war after capitulation owner
	
	# ROOT is capitulated country, FROM is winner
	on_capitulation = {
		effect = {
			if = {
				limit = {
					date < 1941.6.1
					FROM = { tag = GER }
				}
				every_state = {
					limit = {
						is_core_of = ROOT
						has_resistance = yes
					}
					add_compliance = 20
				}
			}
			if = { #Dissolve Miedzomyre if Pol capitulates & let POl join Allies
				limit = {
					original_tag = POL
					#has_government = neutrality
					is_faction_leader = yes
					ENG = { is_in_faction = yes } 
				}
				POL = { dismantle_faction = yes }
				ENG = { add_to_faction = POL }
			}
		}
	}

#ROOT is winner #FROM gets annexed - This will also fire on_annex
	on_civil_war_end = {
		effect = {
			# Make SAFR Nazi puppet Ger if CW triggered by their decision
			if = {
				limit = {
					original_tag = SAF
					has_government = fascism
					has_idea = SAF_strong_apartheid
					FROM = {
						original_tag = SAF
						has_government = democratic
					}
				}
				GER = { # Check this ok?? Root ok?
					set_autonomy = { target = ROOT autonomy_state = autonomy_reichsprotectorate freedom_level = 0.75 }
				}
			}
		}
	}
}